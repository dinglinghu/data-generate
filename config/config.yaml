# STK卫星星座数据采集系统配置文件
# 严格按照ADK官网文档要求进行配置

# 仿真场景时间配置
simulation:
  start_time: "2025/08/06 00:00:00"    # 仿真开始时间 - 更新为当前日期
  end_time: "2025/08/13 00:00:00"      # 仿真结束时间 - 7天时间窗口
  epoch_time: "2025/08/06 00:00:00"    # 仿真基准时间 - 与开始时间一致
  time_step: 60                        # 仿真时间步长(秒)
  time_format: "%Y/%m/%d %H:%M:%S"     # 时间格式

  # 数据采集配置
  data_collection:
    interval_range: [60, 300]          # 采集时间间隔范围(秒)
    save_frequency: 10                  # 保存频率
    total_collections: 50               # 总采集次数目标

# Walker星座配置
constellation:
  type: "Walker"
  planes: 4                    # 轨道面数量 - 增加覆盖均匀性
  satellites_per_plane: 6      # 每个轨道面的卫星数量 - 优化分布
  total_satellites: 24          # 总卫星数量

  # Walker星座参考卫星轨道参数
  reference_satellite:
    altitude: 1600             # 轨道高度(km) - 对应半长轴约8171km
    inclination: 97.6        # 轨道倾角(度) - 类似ISS轨道
    eccentricity: 0.0          # 偏心率 - 圆轨道
    arg_of_perigee: 0.0        # 近地点幅角(度) - 圆轨道时无意义，设为0
    raan_offset: 0.0           # RAAN起始偏移(度) - 第一个轨道面的RAAN
    mean_anomaly_offset: 0.0   # 平近点角起始偏移(度) - 第一颗卫星的初始位置

  # Walker星座特有参数
  walker_parameters:
    phase_factor: 1            # 相位因子F - 控制轨道面间卫星相对位置
    pattern_type: "delta"      # Walker模式: "delta" 或 "star"
  
# 载荷参数配置
payload:
  type: "Optical_Sensor"
  mounting: "Gimbal"           # 载荷安装方向：万向节安装，提供导弹跟踪机动性
  sensor_pattern: "Complex_Conic"  # 传感器模式：复杂圆锥，适合动态目标跟踪
  inner_cone_half_angle: 40.0  # 内锥半角(度) - 扩大近距离导弹探测范围
  outer_cone_half_angle: 75.0  # 外锥半角(度) - 减小以增加探测范围
  clockwise_angle_min: 0.0   # 最小时钟角(度) - STK兼容：240-360度范围
  clockwise_angle_max: 120.0   # 最大时钟角(度) - 覆盖120度扫描范围
  pointing:
    azimuth: 330.0            # 指向方位角(度) - 调整-30度使扫描中心对准前向
    elevation: 75.0           # 指向俯仰角(度)
  constraints_range:
    min_range: 100            # 最小距离(km) - 避免近地干扰
    max_range: 10000           # 最大距离(km)
    active: true              # 是否启用约束

# 导弹目标配置
missile:
  max_concurrent_missiles: 5   # 场景中同时在中段飞行的导弹数量最大值
  flight_altitude:             # 导弹飞行高度配置
    min_altitude: 1000         # 最低飞行高度(km) - ICBM中段飞行高度
    max_altitude: 1500         # 最高飞行高度(km) - ICBM最大飞行高度

# 任务规划配置
task_planning:
  # 中段飞行高度阈值配置
  midcourse_altitude_threshold: 800  # 中段高度阈值(km) - ICBM进入中段飞行的高度阈值
  altitude_analysis:
    enable_strict_threshold: true    # 启用严格的高度阈值判断
    min_midcourse_duration: 900      # 最小中段飞行时间(秒) - 15分钟（ICBM中段飞行时间）
    altitude_buffer: 50              # 高度缓冲区(km) - ICBM高度变化较大，需要更大缓冲区
    max_time_difference: 600         # 最大时间差阈值(秒) - 超过此值发出警告
  atomic_task_duration: 300          # 原子任务持续时间(秒) - 5分钟适合ICBM跟踪

# 元任务管理配置
meta_task_management:
  # 元子任务时间间隔配置
  atomic_task_interval: 300          # 元子任务时间间隔(秒) - 5分钟

  # 可见任务判定标准
  visible_task_criteria:
    coverage_requirement: "partial"   # 覆盖要求: complete(完全覆盖), partial(部分覆盖)
    minimum_overlap_ratio: 0.8        # 最小重叠比例 (0.0-1.0) - 10%重叠即可
    enable_position_sync: true        # 启用卫星位置同步功能

  # 位置同步配置
  position_sync:
    sample_interval_seconds: 30       # 位置采样间隔(秒)
    max_samples_per_task: 20          # 每个任务最大采样点数
    enable_statistics: true           # 启用位置统计计算
    export_detailed_data: false       # 导出详细位置数据

    # 并行处理配置
    enable_parallel_optimization: true  # 启用并行优化模式
    enable_concurrent: true            # 启用并发处理（回退模式）
    max_workers: 8                     # 最大工作线程数
    concurrent_batch_size: 20          # 并发批处理大小
    stk_com_timeout: 10                # STK COM调用超时时间(秒)

    # 并行性能优化
    parallel_batch_size: 50            # 并行批处理大小
    enable_position_cache: false       # 启用位置缓存
    cache_timeout_minutes: 30          # 缓存超时时间(分钟)
    async_mode: true                   # 启用异步模式
    thread_pool_size: 8                # 线程池大小

    # 并发处理配置
    enable_concurrent: true           # 启用并发处理
    max_workers: 4                    # 最大工作线程数
    concurrent_batch_size: 10         # 并发批处理大小
    stk_com_timeout: 30               # STK COM接口超时时间(秒)

  # 飞行阶段配置
  flight_phases:
    boost_phase_ratio: 0.2            # 助推段占比
    terminal_phase_ratio: 0.2         # 末段占比
    midcourse_ratio: 0.6              # 中段占比（自动计算：1.0 - boost - terminal）

  # 标准化配置
  standardization:
    standard_duration: 2400           # 标准持续时间(秒) - 40分钟
    min_duration: 1800                # 最小持续时间(秒) - 30分钟
    max_duration: 2700                # 最大持续时间(秒) - 45分钟
    overlap_duration: 300             # 重叠持续时间(秒) - 5分钟

# 数据采集配置
data_collection:
  # 滚动数据采集配置
  rolling_collection:
    enable: true                     # 启用滚动采集
    total_collections: 2000          # 总采集次数（支持大规模采集）
    interval_range: [180, 300]       # 采集时间间隔范围(秒) 3-5分钟（适合ICBM）
    max_scenario_duration: 6048000    # 最大场景持续时间(秒) 70天（支持长时间采集）

    # 导弹动态管理配置
    dynamic_missiles:
      # 导弹数量控制
      missile_count_range: [3, 8]    # 每次采集创建的导弹数量范围 [最小, 最大] - 增加数量确保中段飞行
      clear_existing_missiles: false # 保留现有导弹，确保连续性
      launch_at_collection_time: true # 导弹发射时间为当前采集时刻
      only_midcourse_targets: true   # 只采集中段飞行的导弹

      # 导弹飞行参数
      flight_duration_range: [1500, 2100]  # 飞行时间范围(秒) 25-35分钟（ICBM）
      launch_time_offset_range: [-600, 600] # 发射时间相对采集时间的偏移范围(秒) - 扩大范围

# STK软件配置
stk:
  detect_existing_project: true      # 是否检测现有STK项目
  existing_project_wait_time: 5      # 现有项目检测等待时间(秒)
  max_connections: 5                 # 最大连接数
  connection_timeout: 30             # 连接超时时间(秒)
  com_timeout: 30                    # STK COM接口超时时间(秒)

  # STK对象类型枚举
  object_types:
    satellite: 18                    # 卫星对象类型
    sensor: 20                       # 传感器对象类型
    target: 20                       # 目标对象类型
    missile: 13                      # 导弹对象类型

  # STK传播器类型
  propagator_types:
    j2_perturbation: 1               # J2摄动传播器

  # STK等待时间配置
  wait_times:
    object_creation: 2.0             # 对象创建等待时间(秒)
    sensor_creation: 1.0             # 传感器创建等待时间(秒)
    access_computation: 1.0          # 访问计算等待时间(秒)
    constraint_setup: 0.5            # 约束设置等待时间(秒)

# 导弹池配置
missile_pool:
  enable: true                       # 启用导弹池
  pool_size: 200                      # 导弹池大小
  active_limit: 20                   # 同时活跃导弹数限制 - 增加以支持大规模采集
  default_flight_duration: 1800     # 默认飞行时间(秒) - ICBM典型飞行时间
  id_random_range: [1000, 9999]     # 导弹ID随机数范围

  # 导弹激活配置
  activation:
    launch_time_offset_range: [-600, 600]  # 发射时间偏移范围(秒) ±10分钟 - 扩大范围确保连续性
    flight_duration_range: [1500, 2100]    # 飞行时间范围(秒) 25-35分钟（ICBM典型飞行时间）

  # 位置生成配置
  position_generation:
    launch_positions:
      lat_range: [-60.0, 70.0]       # 发射位置纬度范围(度) - 全球范围（排除极地）
      lon_range: [-180.0, 180.0]     # 发射位置经度范围(度) - 全球范围
      alt: 0.0                       # 发射位置高度(km)
    target_positions:
      lat_range: [-60.0, 70.0]       # 目标位置纬度范围(度) - 全球范围（排除极地）
      lon_range: [-180.0, 180.0]     # 目标位置经度范围(度) - 全球范围
      alt: 0.0                       # 目标位置高度(km)

  # 性能统计配置
  performance:
    creation_time_multiplier: 10     # 创建时间倍数（用于估算节省时间）
    hit_rate_calculation: true       # 启用命中率计算

# 导弹管理配置
missile_management:
  position_generation:
    min_distance_deg: 10             # 最小距离(度)
    max_attempts: 10                 # 最大尝试次数
    id_range: [1000, 9999]           # ID范围
  flight_time:
    default_minutes: 30              # 默认飞行时间(分钟)
  trajectory_data:
    time_step_seconds: 30            # 轨迹数据时间步长(秒)
    default_column_count: 4          # 默认DataSet列数(Time, Lat, Lon, Alt)

# 可见性计算配置
visibility:
  access_constraints:
    min_altitude: -45.0                # 最小高度角(度) - 降低以增加可见性
    sun_elevation_min: -10.0         # 最小太阳高度角(度)
  cache:
    timeout: 300                     # 缓存超时时间(秒)

# 数据模拟配置
data_simulation:
  payload_status:
    power_consumption: 80.0          # 功耗(瓦)
    temperature: 25.0                # 温度(摄氏度)
    operational_default: true        # 默认运行状态

# 系统配置
system:
  testing:
    initial_missile_count: 3         # 初始导弹数量
    missile_add_probability: 0.3     # 导弹添加概率
  missile_management_range:
    target_min: 5                    # 目标最小值
    target_max: 20                   # 目标最大值
  delays:
    collection_loop: 0.2             # 采集循环延迟(秒)

# 物理常数配置
physics:
  earth_radius: 6371                 # 地球半径(km)

# 可视化配置
visualization:
  # 甘特图配置
  gantt_chart:
    # 图表尺寸配置
    figure_size: [24, 16]            # 图表尺寸 [宽度, 高度]
    height_ratios: [2, 3]            # 子图高度比例 [元任务图, 可见任务图]
    dpi: 300                         # 图片分辨率

    # 时间轴配置
    time_axis:
      buffer_minutes: 5              # 时间轴前后缓冲时间(分钟)
      default_window_hours: 2        # 默认时间窗口(小时)
      hour_interval: 1               # 主要时间刻度间隔(小时)
      minute_interval: 30            # 次要时间刻度间隔(分钟)
      label_rotation: 45             # 时间标签旋转角度(度)

    # 任务条配置
    task_bars:
      # 元任务条配置
      meta_task:
        height: 0.4                  # 任务条高度
        linewidth: 1                 # 边框线宽
        alpha_real: 0.9              # 真实任务透明度
        alpha_virtual: 0.6           # 虚拟任务透明度
        min_duration_for_label: 30   # 显示标签的最小持续时间(分钟)

      # 可见任务条配置
      visible_task:
        height: 0.7                  # 任务条高度
        linewidth_visible: 2         # 可见任务边框线宽
        linewidth_virtual: 1         # 虚拟任务边框线宽
        alpha_visible: 0.9           # 可见任务透明度
        alpha_virtual: 0.6           # 虚拟任务透明度
        min_duration_for_label: 30   # 显示标签的最小持续时间(分钟)

    # Y轴配置
    y_axis:
      spacing_between_missiles: 1.0  # 导弹间间隔
      spacing_between_combos: 1.5    # 导弹-卫星组合间间隔
      label_fontsize_meta: 10        # 元任务Y轴标签字体大小
      label_fontsize_visible: 9      # 可见任务Y轴标签字体大小

    # 文字配置
    text:
      title_fontsize: 18             # 主标题字体大小
      subtitle_fontsize: 14          # 子标题字体大小
      label_fontsize: 12             # 轴标签字体大小
      task_label_fontsize: 8         # 任务标签字体大小
      legend_fontsize: 10            # 图例字体大小
      legend_alpha: 0.9              # 图例透明度

    # 网格配置
    grid:
      enable: true                   # 启用网格
      alpha: 0.3                     # 网格透明度
      linestyle: "-"                 # 网格线样式
      linewidth: 0.5                 # 网格线宽

    # 颜色配置
    colors:
      # 背景和网格
      background: "#fafafa"
      grid_major: "#e0e0e0"
      grid_minor: "#f5f5f5"
      text_primary: "#212121"
      text_secondary: "#757575"

      # 元任务相关颜色
      meta_task_background: "#e8f4fd"     # 浅蓝背景
      meta_task_border: "#1e88e5"        # 深蓝边框
      meta_task_text: "#0d47a1"          # 深蓝文字

      # 可见元任务颜色
      visible_meta_task: "#4caf50"       # 绿色 - 可见元任务
      visible_meta_border: "#2e7d32"     # 深绿边框

      # 真实元子任务颜色
      real_meta_task: "#4caf50"          # 绿色 - 真实元子任务
      real_meta_border: "#2e7d32"        # 深绿边框

      # 虚拟元子任务颜色
      virtual_meta_task: "#e8f4fd"       # 浅蓝背景 - 虚拟元子任务（使用元子任务样式）
      virtual_meta_border: "#1e88e5"     # 深蓝边框 - 虚拟元子任务（使用元子任务样式）

      # 虚拟原子任务颜色
      virtual_atomic_task: "#ff9800"     # 橙色 - 虚拟原子任务
      virtual_atomic_border: "#f57c00"   # 深橙边框

      # 可见虚拟原子任务颜色（用于可见元任务甘特图）
      visible_virtual_atomic_task: "#e0e0e0"    # 灰色底色 - 可见虚拟原子任务
      visible_virtual_atomic_border: "#1976d2"  # 蓝色边框 - 可见虚拟原子任务

      # 导弹飞行相关颜色
      missile_flight: "#f44336"          # 红色 - 导弹飞行
      missile_midcourse: "#9c27b0"       # 紫色 - 中段飞行
      missile_border: "#d32f2f"          # 深红边框

      # 卫星颜色（9种不同颜色）
      satellite_colors:
        - "#2196f3"  # 蓝色
        - "#ff9800"  # 橙色
        - "#4caf50"  # 绿色
        - "#e91e63"  # 粉红色
        - "#9c27b0"  # 紫色
        - "#795548"  # 棕色
        - "#607d8b"  # 蓝灰色
        - "#ff5722"  # 深橙色
        - "#3f51b5"  # 靛蓝色

      # 状态颜色
      active: "#00c853"
      inactive: "#bdbdbd"
      critical: "#d50000"
      warning: "#ff6f00"

  # 时间轴转换器配置
  timeline_converter:
    # 虚拟任务采样配置
    virtual_task_sampling:
      display_interval: 10           # 每N个虚拟任务显示1个

    # 任务默认值配置
    task_defaults:
      task_index: 0                  # 默认任务索引
      coverage_ratio: 0.0            # 默认覆盖率
      alpha_real: 0.9                # 真实任务默认透明度
      alpha_virtual: 0.6             # 虚拟任务默认透明度
      alpha_default: 0.9             # 默认透明度

# 输出配置
output:
  # 基础输出目录
  base_directory: "output"                          # 基础输出目录
  data_directory: "output/data"                     # 数据输出目录
  log_directory: "logs"                             # 日志输出目录
  visualization_directory: "output/visualization"   # 可视化输出目录
  charts_directory: "output/charts"                 # 图表输出目录

  # 滚动采集输出配置
  rolling_collections:
    base_directory: "output/rolling_collections"    # 滚动采集基础目录
    default_fallback: "output/data"                 # 默认回退目录

  # 文件命名配置
  file_naming:
    session_prefix: "session_"                      # 会话前缀
    collection_prefix: "collection_"                # 采集前缀
    log_prefix: "rolling_collection_"               # 日志前缀
    data_filename: "meta_task_data.json"            # 数据文件名
    gantt_filename_template: "collection_{:02d}_aerospace_meta_task_gantt.png"  # 甘特图文件名模板
